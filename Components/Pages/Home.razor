@page "/"
@inject NavigationManager NavManager
@rendermode InteractiveServer
@using GooruuSearchApp.Services
@inject MockSearchService SearchService
<PageTitle>Gooruu</PageTitle>

<div class="search-container">
    <div class="gooruu-logo">
        <span class="g-blue">G</span>
        <span class="g-red">o</span>
        <span class="g-yellow">o</span>
        <span class="g-blue">r</span>
        <span class="g-green">u</span>
        <span class="g-red">u</span>
    </div>

    <div class="search-input-wrapper">
        <span class="material-icons" style="position:absolute; left:15px; top:10px; color:#9aa0a6;">search</span>

        <input type="text"
               class="search-input"
               placeholder="ค้นหาใน Gooruu หรือ พิมพ์ URL"
               @bind="searchQuery"
               @onkeyup="HandleEnter" />
    </div>

    <div style="margin-top: 30px;">
        <button class="btn btn-light me-2" @onclick="DoSearch">
            ค้นหาด้วย Gooruu
        </button>

        <button class="btn btn-light" @onclick="DoLuckySearch">
            ดีใจจัง ค้นแล้วเจอเลย
        </button>
    </div>
</div>

@code {
    private string searchQuery = "";

    // ฟังก์ชันกด Enter ในช่องค้นหา
    private void HandleEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter") DoSearch();
    }

    // 1. ฟังก์ชันปุ่มค้นหาปกติ -> ไปหน้า Search
    private void DoSearch()
    {
        if (!string.IsNullOrWhiteSpace(searchQuery))
        {
            NavManager.NavigateTo($"/search?q={Uri.EscapeDataString(searchQuery)}");
        }
    }

    // 2. ฟังก์ชันปุ่มดีใจจัง -> ไปหน้าข่าวแรกทันที
    private void DoLuckySearch()
    {
        // ค้นหาข้อมูลจาก Service ก่อน
        var results = SearchService.Search(searchQuery);

        if (results.Any())
        {
            // ถ้าเจอข่าว ให้เปิดข่าวแรกสุดทันที (ข้ามหน้า Search Result)
            var firstNewsId = results.First().Id;
            NavManager.NavigateTo($"/news/{firstNewsId}");
        }
        else
        {
            // ถ้าไม่เจออะไรเลย หรือไม่ได้พิมพ์ ให้สุ่มไปหน้า Search ปกติ
            DoSearch();
        }
    }
}